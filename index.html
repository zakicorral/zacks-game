<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  // Game state
  let isPlaying = false;
  let score = 0;
  let frame = 0;

  // Player
  const player = {
    x: 50,
    y: 300,
    width: 72,
    height: 72,
    dy: 0,
    jumpPower: -12,
    grounded: false,
    sprite: new Image(),
    frameX: 0,
    frameY: 0,
    speed: 0.2
  };
  player.sprite.src = "images/player_run.png"; // <-- put in images folder

  // Background layers
  const sky = new Image();
  sky.src = "images/1.png"; // sky

  const clouds = new Image();
  clouds.src = "images/2.png"; // clouds

  const farGround = new Image();
  farGround.src = "images/3.png"; // far ground (mountains etc.)

  const closeGround = new Image();
  closeGround.src = "images/4.png"; // close ground

  const bird = new Image();
  bird.src = "images/5.png"; // bird

  // Scrolling positions
  let bgLayers = [
    { img: sky, x: 0, speed: 0.2 },
    { img: clouds, x: 0, speed: 0.5 },
    { img: farGround, x: 0, speed: 1.5 },
    { img: closeGround, x: 0, speed: 3 }
  ];

  // Obstacles
  const obstacleSprite = new Image();
  obstacleSprite.src = "images/obstacle.png";
  const obstacles = [];

  function spawnObstacle() {
    obstacles.push({
      x: canvas.width,
      y: 330,
      width: 50,
      height: 50,
      speed: 6
    });
  }

  function update() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    frame++;

    // Draw background layers
    bgLayers.forEach(layer => {
      layer.x -= layer.speed;
      if (layer.x <= -canvas.width) layer.x = 0;
      ctx.drawImage(layer.img, layer.x, 0, canvas.width, canvas.height);
      ctx.drawImage(layer.img, layer.x + canvas.width, 0, canvas.width, canvas.height);
    });

    // Bird floating (optional little animation)
    let birdY = 100 + Math.sin(frame * 0.05) * 10;
    ctx.drawImage(bird, 600, birdY, 60, 60);

    // Player physics
    player.y += player.dy;
    if (player.y + player.height < 380) {
      player.dy += 0.6; // gravity
      player.grounded = false;
    } else {
      player.y = 380 - player.height;
      player.dy = 0;
      player.grounded = true;
    }

    // Player animation
    if (isPlaying) {
      player.frameX += player.speed;
      if (player.frameX >= 6) player.frameX = 0;
    }
    ctx.drawImage(
      player.sprite,
      Math.floor(player.frameX) * player.width, 0,
      player.width, player.height,
      player.x, player.y, player.width, player.height
    );

    // Obstacles
    for (let i = 0; i < obstacles.length; i++) {
      let ob = obstacles[i];
      ob.x -= ob.speed;
      ctx.drawImage(obstacleSprite, ob.x, ob.y, ob.width, ob.height);

      // Collision
      if (player.x < ob.x + ob.width &&
          player.x + player.width > ob.x &&
          player.y < ob.y + ob.height &&
          player.y + player.height > ob.y) {
        gameOver();
      }

      // Remove off-screen
      if (ob.x + ob.width < 0) {
        obstacles.splice(i, 1);
        score++;
        document.getElementById("score").innerText = score;
      }
    }

    if (isPlaying) requestAnimationFrame(update);
  }

  function jump() {
    if (player.grounded) {
      player.dy = player.jumpPower;
    }
  }

  function gameOver() {
    isPlaying = false;
    alert("Game Over! Final Score: " + score);
    location.reload();
  }

  // Controls
  document.addEventListener("keydown", e => {
    if (e.code === "Space") jump();
  });

  document.getElementById("startBtn").addEventListener("click", () => {
    isPlaying = true;
    score = 0;
    document.getElementById("score").innerText = score;
    setInterval(spawnObstacle, 2000);
    update();
    document.getElementById("startBtn").style.display = "none";
  });
</script>
